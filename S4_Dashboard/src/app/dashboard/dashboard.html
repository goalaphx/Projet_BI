<div class="saas-container">
  
  <header class="saas-header">
    <div class="brand-section">
      <div class="logo-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
      </div>
      <div>
        <h1>Analytics Dashboard</h1>
        <span class="subtitle">Research & Publication Metrics</span>
      </div>
    </div>
    
    <div class="actions-section">
      <div class="filter-dropdown">
        <label>Year</label>
        <select [(ngModel)]="selectedYear" (change)="onFilterChange()">
          <option *ngFor="let y of availableYears" [value]="y">{{ y }}</option>
        </select>
      </div>

      <div class="filter-dropdown">
        <label>Region</label>
        <select [(ngModel)]="selectedCountry" (change)="onFilterChange()">
          <option *ngFor="let c of availableCountries" [value]="c">{{ c }}</option>
        </select>
      </div>

      <button class="theme-switch" (click)="toggleDarkMode()" title="Toggle Theme">
        <span *ngIf="!isDarkMode">üåô</span>
        <span *ngIf="isDarkMode">‚òÄÔ∏è</span>
      </button>
    </div>
  </header>

  <section class="kpi-grid">
    <div class="card kpi">
      <div class="icon-box blue"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg></div>
      <div>
        <h3>Publications</h3>
        <p class="value">{{ kpiData.total_pubs || 0 | number }}</p>
      </div>
    </div>
    
    <div class="card kpi">
      <div class="icon-box green"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg></div>
      <div>
        <h3>Avg Impact</h3>
        <p class="value">{{ kpiData.avg_impact | number:'1.1-2' }}</p>
      </div>
    </div>

    <div class="card kpi">
      <div class="icon-box purple"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg></div>
      <div>
        <h3>Citations</h3>
        <p class="value">{{ kpiData.total_citations || 0 | number }}</p>
      </div>
    </div>

    <div class="card kpi">
      <div class="icon-box orange"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg></div>
      <div>
        <h3>Authors</h3>
        <p class="value">{{ kpiData.total_authors || 0 | number }}</p>
      </div>
    </div>
  </section>

  <div class="nav-bar">
    <button (click)="setTab(1)" [class.active]="currentTab === 1">Trends</button>
    <button (click)="setTab(2)" [class.active]="currentTab === 2">Quality</button>
    <button (click)="setTab(3)" [class.active]="currentTab === 3">Global</button>
    <button (click)="setTab(4)" [class.active]="currentTab === 4">Topics</button>
    <button (click)="setTab(5)" [class.active]="currentTab === 5">Network</button>
  </div>

  <main class="content-area">
    
    <div *ngIf="currentTab === 1" class="card chart-panel">
      <div class="panel-header"><h3>Publication Trends</h3></div>
      <div id="chartdiv" class="chart-container">
        <div *ngIf="isLoading" class="loader"><div class="spinner"></div></div>
      </div>
    </div>

    <div *ngIf="currentTab === 2" class="card chart-panel">
      <div class="panel-header"><h3>Journal Quartile Distribution</h3></div>
      <div id="piediv" class="chart-container">
        <div *ngIf="isLoading" class="loader"><div class="spinner"></div></div>
      </div>
    </div>

    <div *ngIf="currentTab === 3" class="split-view">
      <div class="card chart-panel">
        <div class="panel-header"><h3>Geographic Heatmap</h3></div>
        <div id="mapdiv" class="chart-container">
          <div *ngIf="isLoading" class="loader"><div class="spinner"></div></div>
        </div>
      </div>
      <div class="card chart-panel">
        <div class="panel-header"><h3>Top Authors</h3></div>
        <div id="authorsdiv" class="chart-container">
          <div *ngIf="isLoading" class="loader"><div class="spinner"></div></div>
        </div>
      </div>
    </div>

    <div *ngIf="currentTab === 4" class="card chart-panel">
      <div class="panel-header"><h3>Keyword Cloud</h3></div>
      <div id="worddiv" class="chart-container">
        <div *ngIf="isLoading" class="loader"><div class="spinner"></div></div>
      </div>
    </div>

    <div *ngIf="currentTab === 5" class="card chart-panel">
      <div class="panel-header"><h3>Co-Authorship Network</h3></div>
      <div id="networkdiv" class="chart-container tall">
        <div *ngIf="isLoading" class="loader"><div class="spinner"></div></div>
      </div>
    </div>

  </main>
</div>